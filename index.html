<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>BLACK CODE BROWSER ‚Äî ATOMIC ‚äó KUHUL v1.2.3</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#16f2aa">
  <style>
    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       ATOMIC CSS CORE ‚Äî Inline for instant render
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    :root {
      --bg-0:#020409;--bg-1:#050912;--bg-2:#071022;--bg-3:#0a1530;
      --panel:rgba(255,255,255,.045);--panel2:rgba(255,255,255,.06);
      --border:rgba(255,255,255,.14);--border-soft:rgba(255,255,255,.09);--border-strong:rgba(255,255,255,.22);
      --fg-0:#eafff8;--fg-1:rgba(234,255,248,.78);--fg-2:rgba(234,255,248,.56);--fg-3:rgba(234,255,248,.38);
      --accent:#16f2aa;--accent2:#61e7ff;--accent-soft:rgba(22,242,170,.14);--accent-glow:rgba(22,242,170,.35);
      --danger:#ff6b6b;--danger-soft:rgba(255,107,107,.14);
      --success:#00d9a6;--warning:#ffb300;
      --r-sm:8px;--r-md:12px;--r-lg:16px;--r-xl:20px;--r-pill:999px;
      --sp-xs:4px;--sp-sm:8px;--sp-md:16px;--sp-lg:24px;--sp-xl:32px;
      --trans-fast:.15s ease;--trans-normal:.3s ease;
      --shadow-md:0 8px 24px rgba(0,0,0,.4);--shadow-glow:0 0 40px var(--accent-glow);
      --font-sans:system-ui,-apple-system,sans-serif;--font-mono:"JetBrains Mono","Fira Code",monospace;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%;background:var(--bg-0);color:var(--fg-0);font-family:var(--font-sans);overflow:hidden}

    /* Layout */
    #app{height:100%;display:flex;flex-direction:column}
    .header{display:flex;align-items:center;justify-content:space-between;padding:10px 16px;background:linear-gradient(180deg,var(--bg-1),var(--bg-2));border-bottom:1px solid var(--border);flex-shrink:0}
    .header-left{display:flex;align-items:center;gap:12px}
    .logo{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--accent-soft),transparent);border:1px solid var(--accent);display:flex;align-items:center;justify-content:center;font-size:16px}
    .header-title{font-size:13px;line-height:1.3}
    .header-title strong{font-size:14px;display:block}
    .header-title span{color:var(--fg-2);font-size:11px}
    .header-center{flex:1;max-width:600px;margin:0 24px}
    .url-bar{display:flex;gap:8px}
    .url-input{flex:1;padding:8px 16px;border-radius:var(--r-pill);border:1px solid var(--border);background:var(--bg-1);color:var(--fg-0);font-size:13px}
    .url-input:focus{outline:none;border-color:var(--accent);box-shadow:0 0 16px var(--accent-soft)}
    .header-right{display:flex;align-items:center;gap:8px}

    /* Buttons */
    .btn{display:inline-flex;align-items:center;gap:6px;padding:7px 14px;border-radius:var(--r-pill);border:1px solid var(--border);background:var(--panel);color:var(--fg-1);font-size:12px;cursor:pointer;transition:all var(--trans-fast);white-space:nowrap}
    .btn:hover{background:var(--panel2);border-color:var(--border-strong);transform:translateY(-1px)}
    .btn-primary{background:linear-gradient(135deg,var(--accent-soft),transparent);border-color:var(--accent);color:var(--accent)}
    .btn-primary:hover{background:var(--accent);color:var(--bg-0)}
    .btn-sm{padding:5px 10px;font-size:11px}
    .btn-icon{width:28px;height:28px;padding:0;justify-content:center}
    .chip{display:inline-flex;align-items:center;gap:6px;padding:5px 10px;border-radius:var(--r-pill);border:1px solid var(--border);font-size:11px;color:var(--fg-2)}
    .chip-dot{width:6px;height:6px;border-radius:50%;background:var(--success);box-shadow:0 0 8px var(--success)}

    /* Main Area */
    .main{display:flex;flex:1;min-height:0}
    .sidebar{width:280px;min-width:280px;display:flex;flex-direction:column;border-right:1px solid var(--border);background:var(--bg-1)}
    .sidebar-header{padding:12px;border-bottom:1px solid var(--border-soft)}
    .sidebar-tabs{display:flex;gap:2px;padding:3px;border-radius:var(--r-md);background:var(--panel);border:1px solid var(--border)}
    .sidebar-tab{flex:1;padding:6px;border-radius:var(--r-sm);border:none;background:transparent;color:var(--fg-2);font-size:11px;cursor:pointer;text-align:center}
    .sidebar-tab.active{background:var(--bg-1);color:var(--fg-0);box-shadow:0 0 0 1px var(--border-strong)}
    .sidebar-body{flex:1;overflow-y:auto;padding:12px}
    .sidebar-section{margin-bottom:16px}
    .sidebar-section-title{font-size:11px;color:var(--fg-2);margin-bottom:8px;display:flex;justify-content:space-between;align-items:center}

    /* Canvas Area */
    .canvas-area{flex:1;display:flex;flex-direction:column;min-width:0;background:var(--bg-0)}
    .canvas-tabs{display:flex;gap:2px;padding:4px 8px;background:var(--bg-2);border-bottom:1px solid var(--border);overflow-x:auto;flex-shrink:0}
    .canvas-tabs::-webkit-scrollbar{height:4px}
    .canvas-tabs::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}
    .canvas-tab{display:flex;align-items:center;gap:6px;padding:6px 12px;border-radius:var(--r-sm);background:var(--panel);border:1px solid transparent;font-size:11px;color:var(--fg-2);cursor:pointer;white-space:nowrap;max-width:160px;min-width:80px}
    .canvas-tab.active{background:var(--bg-1);border-color:var(--border);color:var(--fg-0)}
    .canvas-tab-title{flex:1;overflow:hidden;text-overflow:ellipsis}
    .canvas-tab-close{width:14px;height:14px;border-radius:50%;border:none;background:transparent;color:var(--fg-3);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:9px;opacity:0;transition:all var(--trans-fast)}
    .canvas-tab:hover .canvas-tab-close{opacity:1}
    .canvas-tab-close:hover{background:var(--danger-soft);color:var(--danger)}
    .canvas-new{padding:6px 10px;border:1px dashed var(--border);color:var(--fg-3)}
    .canvas-new:hover{border-color:var(--accent);color:var(--accent)}
    .canvas-viewport{flex:1;display:flex;flex-direction:column;min-height:0;position:relative}
    .canvas-frame{flex:1;border:none;background:var(--bg-0)}
    .canvas-content{flex:1;overflow:auto;padding:16px;font-family:var(--font-mono);font-size:12px;line-height:1.6}
    .canvas-loading{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:var(--bg-0);color:var(--fg-2)}
    .canvas-loading.hidden{display:none}

    /* Tape List */
    .tape-item{display:flex;align-items:center;gap:10px;padding:10px;border-radius:var(--r-md);border:1px solid var(--border-soft);background:var(--panel);margin-bottom:6px;cursor:pointer;transition:all var(--trans-fast)}
    .tape-item:hover{border-color:var(--border);background:var(--panel2)}
    .tape-icon{width:28px;height:28px;border-radius:var(--r-sm);background:linear-gradient(135deg,var(--accent-soft),transparent);display:flex;align-items:center;justify-content:center;font-size:12px}
    .tape-info{flex:1;min-width:0}
    .tape-name{font-size:12px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .tape-meta{font-size:10px;color:var(--fg-3)}
    .tape-actions{display:flex;gap:4px;opacity:0;transition:opacity var(--trans-fast)}
    .tape-item:hover .tape-actions{opacity:1}

    /* Modal */
    .modal{position:fixed;inset:0;background:rgba(2,4,9,.92);backdrop-filter:blur(20px);display:none;align-items:center;justify-content:center;z-index:9999}
    .modal.active{display:flex}
    .modal-content{background:linear-gradient(145deg,var(--bg-1),var(--bg-2));border:1px solid var(--border);border-radius:var(--r-xl);padding:24px;width:90%;max-width:560px;max-height:80vh;overflow-y:auto;box-shadow:var(--shadow-md),var(--shadow-glow)}
    .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:12px;border-bottom:1px solid var(--border-soft)}
    .modal-title{font-size:16px;font-weight:600}
    .modal-close{width:28px;height:28px;border-radius:50%;border:1px solid var(--border);background:transparent;color:var(--fg-2);cursor:pointer;display:flex;align-items:center;justify-content:center}
    .modal-close:hover{border-color:var(--danger);color:var(--danger);background:var(--danger-soft)}
    .modal-body{display:flex;flex-direction:column;gap:16px}
    .form-group{display:flex;flex-direction:column;gap:6px}
    .form-label{font-size:11px;color:var(--fg-2);text-transform:uppercase;letter-spacing:.5px}
    .form-input{padding:10px 14px;border-radius:var(--r-md);border:1px solid var(--border);background:var(--bg-0);color:var(--fg-0);font-size:13px}
    .form-input:focus{outline:none;border-color:var(--accent);box-shadow:0 0 12px var(--accent-soft)}
    .form-textarea{min-height:120px;resize:vertical;font-family:var(--font-mono)}
    .form-row{display:flex;gap:12px}
    .form-row > *{flex:1}
    .modal-footer{display:flex;justify-content:flex-end;gap:8px;margin-top:20px;padding-top:16px;border-top:1px solid var(--border-soft)}

    /* Settings */
    .setting-item{display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:var(--r-md);border:1px solid var(--border-soft);background:var(--panel);margin-bottom:8px}
    .setting-info{flex:1}
    .setting-name{font-size:13px;font-weight:500}
    .setting-desc{font-size:11px;color:var(--fg-3)}
    .toggle{width:40px;height:22px;border-radius:11px;background:var(--bg-2);border:1px solid var(--border);cursor:pointer;position:relative;transition:all var(--trans-fast)}
    .toggle.active{background:var(--accent);border-color:var(--accent)}
    .toggle::after{content:'';position:absolute;top:2px;left:2px;width:16px;height:16px;border-radius:50%;background:var(--fg-0);transition:transform var(--trans-fast)}
    .toggle.active::after{transform:translateX(18px)}

    /* Status Bar */
    .status-bar{padding:6px 16px;background:var(--bg-2);border-top:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;font-size:11px;color:var(--fg-3);flex-shrink:0}
    .status-left{display:flex;align-items:center;gap:16px}
    .status-right{display:flex;align-items:center;gap:16px}

    /* Drag handle for tabs */
    .canvas-tab.dragging{opacity:.5}
    .canvas-tab.drag-over{border-color:var(--accent)}

    /* Responsive */
    @media(max-width:768px){
      .sidebar{display:none}
      .header-center{margin:0 12px}
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <div class="logo">‚üÅ</div>
        <div class="header-title">
          <strong>BLACK CODE BROWSER</strong>
          <span>ATOMIC ‚äó KUHUL v1.2.3</span>
        </div>
      </div>

      <div class="header-center">
        <div class="url-bar">
          <input type="text" class="url-input" id="urlInput" placeholder="Enter URL or API endpoint...">
          <button class="btn btn-primary" id="urlGoBtn">Go</button>
        </div>
      </div>

      <div class="header-right">
        <div class="chip">
          <div class="chip-dot"></div>
          <span id="statusChip">Ready</span>
        </div>
        <button class="btn" id="settingsBtn">Settings</button>
        <button class="btn" id="exportBtn">Export</button>
      </div>
    </header>

    <!-- Main -->
    <main class="main">
      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <div class="sidebar-tabs">
            <button class="sidebar-tab active" data-view="tapes">Tapes</button>
            <button class="sidebar-tab" data-view="api">API</button>
            <button class="sidebar-tab" data-view="editor">Editor</button>
          </div>
        </div>
        <div class="sidebar-body" id="sidebarBody">
          <!-- Tapes View -->
          <div class="sidebar-view active" id="view-tapes">
            <div class="sidebar-section">
              <div class="sidebar-section-title">
                <span>Tapes</span>
                <button class="btn btn-sm" id="newTapeBtn">+ New</button>
              </div>
              <div id="tapesList"></div>
            </div>
          </div>

          <!-- API View -->
          <div class="sidebar-view" id="view-api" style="display:none">
            <div class="sidebar-section">
              <div class="sidebar-section-title"><span>Endpoints</span></div>
              <div id="endpointsList"></div>
            </div>
          </div>

          <!-- Editor View -->
          <div class="sidebar-view" id="view-editor" style="display:none">
            <div class="sidebar-section">
              <textarea id="editorArea" class="form-input form-textarea" style="height:300px" placeholder="Code editor..."></textarea>
              <div style="margin-top:8px;display:flex;gap:8px">
                <button class="btn btn-sm" id="editorSaveBtn">Save as Tape</button>
                <button class="btn btn-sm" id="editorRunBtn">Run</button>
              </div>
            </div>
          </div>
        </div>
      </aside>

      <!-- Canvas Area -->
      <section class="canvas-area">
        <!-- Canvas Tabs -->
        <div class="canvas-tabs" id="canvasTabs">
          <div class="canvas-tab active" data-tab="welcome">
            <span class="canvas-tab-title">Welcome</span>
          </div>
          <button class="canvas-tab canvas-new" id="newTabBtn">+</button>
        </div>

        <!-- Canvas Viewport -->
        <div class="canvas-viewport">
          <div class="canvas-loading hidden" id="canvasLoading">
            <span>Loading...</span>
          </div>
          <div class="canvas-content" id="canvasContent">
            <h2 style="color:var(--accent);margin-bottom:16px">‚üÅ BLACK CODE BROWSER</h2>
            <p style="color:var(--fg-2);margin-bottom:24px">Canvas-based DOM projection browser with KUHUL security runtime.</p>

            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px">
              <div style="padding:16px;border-radius:12px;border:1px solid var(--border);background:var(--panel)">
                <div style="font-size:24px;margin-bottom:8px">üìº</div>
                <h4 style="margin-bottom:4px">Tape Storage</h4>
                <p style="font-size:11px;color:var(--fg-3)">Store and manage data with SCXQ2 compression</p>
              </div>
              <div style="padding:16px;border-radius:12px;border:1px solid var(--border);background:var(--panel)">
                <div style="font-size:24px;margin-bottom:8px">üé¨</div>
                <h4 style="margin-bottom:4px">œÄ Routing</h4>
                <p style="font-size:11px;color:var(--fg-3)">Auto-route video/audio to canvas renderers</p>
              </div>
              <div style="padding:16px;border-radius:12px;border:1px solid var(--border);background:var(--panel)">
                <div style="font-size:24px;margin-bottom:8px">üñºÔ∏è</div>
                <h4 style="margin-bottom:4px">Canvas Projection</h4>
                <p style="font-size:11px;color:var(--fg-3)">DOM‚ÜíCanvas rendering bypasses CORS</p>
              </div>
              <div style="padding:16px;border-radius:12px;border:1px solid var(--border);background:var(--panel)">
                <div style="font-size:24px;margin-bottom:8px">üîê</div>
                <h4 style="margin-bottom:4px">KUHUL Security</h4>
                <p style="font-size:11px;color:var(--fg-3)">Capability-based sandbox with IDB sessions</p>
              </div>
            </div>

            <svg id="kuhul_svg_root" width="100%" height="120" style="margin-top:24px;border:1px solid var(--border);border-radius:12px;background:var(--bg-1)">
              <defs>
                <linearGradient id="waveGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                  <stop offset="0%" style="stop-color:#16f2aa;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#61e7ff;stop-opacity:1" />
                </linearGradient>
              </defs>
            </svg>
          </div>
        </div>
      </section>
    </main>

    <!-- Status Bar -->
    <footer class="status-bar">
      <div class="status-left">
        <span id="statusText">SW v1.2.3 Ready</span>
        <span>|</span>
        <span id="storageInfo">0 tapes ‚Ä¢ 0 MB</span>
      </div>
      <div class="status-right">
        <span id="tabCount">1 tab</span>
        <span>|</span>
        <span>IDB Sessions</span>
      </div>
    </footer>
  </div>

  <!-- Tape Modal -->
  <div class="modal" id="tapeModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="tapeModalTitle">New Tape</h3>
        <button class="modal-close" id="tapeModalClose">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Name</label>
          <input type="text" class="form-input" id="tapeName" placeholder="my-file.json">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Type</label>
            <select class="form-input" id="tapeType">
              <option value="json">JSON</option>
              <option value="html">HTML</option>
              <option value="javascript">JavaScript</option>
              <option value="css">CSS</option>
              <option value="markdown">Markdown</option>
              <option value="text">Text</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Compression</label>
            <select class="form-input" id="tapeCompression">
              <option value="none">None</option>
              <option value="scxq2">SCXQ2</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Tags (comma separated)</label>
          <input type="text" class="form-input" id="tapeTags" placeholder="tag1, tag2">
        </div>
        <div class="form-group">
          <label class="form-label">Content</label>
          <textarea class="form-input form-textarea" id="tapeContent" placeholder="Paste or type content..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" id="tapeModalCancel">Cancel</button>
        <button class="btn btn-primary" id="tapeModalSave">Save Tape</button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal" id="settingsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Settings</h3>
        <button class="modal-close" id="settingsModalClose">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="setting-item">
          <div class="setting-info">
            <div class="setting-name">Dark Mode</div>
            <div class="setting-desc">Use dark theme (default)</div>
          </div>
          <div class="toggle active" data-setting="darkMode"></div>
        </div>
        <div class="setting-item">
          <div class="setting-info">
            <div class="setting-name">Animations</div>
            <div class="setting-desc">Enable UI animations</div>
          </div>
          <div class="toggle active" data-setting="animations"></div>
        </div>
        <div class="setting-item">
          <div class="setting-info">
            <div class="setting-name">Auto Compression</div>
            <div class="setting-desc">Compress tapes with SCXQ2</div>
          </div>
          <div class="toggle active" data-setting="autoCompression"></div>
        </div>
        <div class="setting-item">
          <div class="setting-info">
            <div class="setting-name">Projection Cache</div>
            <div class="setting-desc">Cache fetched content</div>
          </div>
          <div class="toggle active" data-setting="projectionCache"></div>
        </div>
        <div class="setting-item">
          <div class="setting-info">
            <div class="setting-name">IDB Sessions</div>
            <div class="setting-desc">Store sessions in IndexedDB</div>
          </div>
          <div class="toggle active" data-setting="idbSessions"></div>
        </div>
        <div class="setting-item">
          <div class="setting-info">
            <div class="setting-name">œÄ Auto-Routing</div>
            <div class="setting-desc">Auto-route media to canvas</div>
          </div>
          <div class="toggle active" data-setting="piAutoRoute"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" id="importDataBtn">Import Data</button>
        <button class="btn btn-primary" id="settingsSaveBtn">Save</button>
      </div>
    </div>
  </div>

  <!-- Export Modal -->
  <div class="modal" id="exportModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Export Data</h3>
        <button class="modal-close" id="exportModalClose">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Format</label>
          <select class="form-input" id="exportFormat">
            <option value="scxq2">SCXQ2 (Compressed)</option>
            <option value="json">JSON (Readable)</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Export Data</label>
          <textarea class="form-input form-textarea" id="exportData" readonly style="height:200px"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" id="copyExportBtn">Copy</button>
        <button class="btn btn-primary" id="downloadExportBtn">Download</button>
      </div>
    </div>
  </div>

  <!-- KUHUL Runtime + App Logic -->
  <script>
  (function KUHUL_APP() {
    'use strict';

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       KUHUL SECURITY RUNTIME (embedded for index security)
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

    const KUHUL = {
      version: '1.2.3',
      caps: {
        dom_read: true,
        dom_write: true,
        net_fetch: true,
        storage: true,
        js_run: false,
        console: true
      },

      // Deep freeze utility
      freeze: (obj, seen = new Set()) => {
        if (!obj || typeof obj !== 'object' || seen.has(obj)) return obj;
        seen.add(obj);
        Object.freeze(obj);
        for (const k of Object.keys(obj)) KUHUL.freeze(obj[k], seen);
        return obj;
      },

      // Safe JSON parse
      parseJSON: (s, fallback = null) => {
        try { return JSON.parse(s); } catch { return fallback; }
      },

      // UID generator
      uid: () => Date.now().toString(36) + Math.random().toString(36).slice(2),

      // Clamp string length
      clamp: (s, max = 4096) => {
        s = String(s ?? '');
        return s.length > max ? s.slice(0, max) : s;
      },

      // Logger device
      log: {
        info: (...args) => console.info('[KUHUL]', ...args),
        warn: (...args) => console.warn('[KUHUL]', ...args),
        error: (...args) => console.error('[KUHUL]', ...args)
      },

      // DOM device
      dom: {
        q: (sel) => document.querySelector(sel),
        qa: (sel) => Array.from(document.querySelectorAll(sel)),
        byId: (id) => document.getElementById(id),
        setText: (el, text) => { if (el) el.textContent = String(text ?? ''); },
        setHTML: (el, html) => { if (el) el.innerHTML = String(html ?? ''); },
        addClass: (el, cls) => el?.classList.add(cls),
        removeClass: (el, cls) => el?.classList.remove(cls),
        toggle: (el, cls) => el?.classList.toggle(cls),
        show: (el) => { if (el) el.style.display = ''; },
        hide: (el) => { if (el) el.style.display = 'none'; }
      },

      // Event binding
      on: (el, event, handler) => {
        if (typeof el === 'string') el = document.querySelector(el);
        el?.addEventListener(event, handler);
      },

      // Safe fetch wrapper
      fetch: async (url, opts = {}) => {
        try {
          const res = await fetch(url, {
            ...opts,
            credentials: 'omit',
            referrerPolicy: 'no-referrer'
          });
          return res;
        } catch (err) {
          KUHUL.log.error('Fetch failed:', err);
          return null;
        }
      }
    };

    KUHUL.freeze(KUHUL.caps);
    window.KUHUL = KUHUL;

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       SERVICE WORKER BRIDGE
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

    const SW = {
      ready: false,
      controller: null,

      async init() {
        if (!('serviceWorker' in navigator)) {
          KUHUL.log.warn('Service Worker not supported');
          return;
        }

        try {
          const reg = await navigator.serviceWorker.register('/sw.js', { scope: '/' });
          KUHUL.log.info('SW registered:', reg.scope);

          navigator.serviceWorker.addEventListener('message', SW.onMessage);

          // Wait for controller
          if (navigator.serviceWorker.controller) {
            SW.controller = navigator.serviceWorker.controller;
            SW.ready = true;
            SW.send({ t: 'BOOT' });
          } else {
            navigator.serviceWorker.addEventListener('controllerchange', () => {
              SW.controller = navigator.serviceWorker.controller;
              SW.ready = true;
              SW.send({ t: 'BOOT' });
            });
          }
        } catch (err) {
          KUHUL.log.error('SW registration failed:', err);
        }
      },

      send(msg) {
        if (SW.controller) {
          SW.controller.postMessage(msg);
        }
      },

      onMessage(event) {
        const msg = event.data;
        if (!msg || !msg.t) return;

        switch (msg.t) {
          case 'STATUS':
            App.setStatus(msg.text);
            break;
          case 'UI_SYNC':
            App.sync(msg);
            break;
          case 'TAPE_OPENED':
            App.openTapeContent(msg.tape);
            break;
          case 'API_RESPONSE':
            App.showAPIResponse(msg.result);
            break;
          case 'CANVAS_PROJECTED':
            App.renderProjection(msg.projection);
            break;
          case 'TAPE_EXPORT_RESULT':
            App.showExportData(msg.data);
            break;
          case 'TAPE_IMPORT_RESULT':
            App.handleImportResult(msg);
            break;
          case 'TAB_CREATED':
            App.addTab(msg.tab, msg.session);
            break;
          case 'TAB_CLOSED':
            App.removeTab(msg.id);
            break;
          case 'CANVAS_FRAME':
            App.renderFrame(msg.state);
            break;
          case 'SCX_RESULT':
            KUHUL.log.info('Compression result:', msg);
            break;
        }
      }
    };

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       APPLICATION STATE & UI
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

    const App = {
      state: {
        tapes: [],
        endpoints: [],
        tabs: [],
        sessions: [],
        settings: {},
        activeTabId: 'welcome',
        editingTapeId: null
      },

      // DOM refs
      el: {},

      init() {
        // Cache DOM elements
        App.el = {
          urlInput: KUHUL.dom.byId('urlInput'),
          urlGoBtn: KUHUL.dom.byId('urlGoBtn'),
          statusChip: KUHUL.dom.byId('statusChip'),
          statusText: KUHUL.dom.byId('statusText'),
          storageInfo: KUHUL.dom.byId('storageInfo'),
          tabCount: KUHUL.dom.byId('tabCount'),
          tapesList: KUHUL.dom.byId('tapesList'),
          endpointsList: KUHUL.dom.byId('endpointsList'),
          canvasTabs: KUHUL.dom.byId('canvasTabs'),
          canvasContent: KUHUL.dom.byId('canvasContent'),
          canvasLoading: KUHUL.dom.byId('canvasLoading'),
          editorArea: KUHUL.dom.byId('editorArea'),
          // Modals
          tapeModal: KUHUL.dom.byId('tapeModal'),
          settingsModal: KUHUL.dom.byId('settingsModal'),
          exportModal: KUHUL.dom.byId('exportModal')
        };

        App.bindEvents();
        App.initSVGWave();
        SW.init();
      },

      bindEvents() {
        // URL bar
        KUHUL.on('#urlGoBtn', 'click', App.navigateURL);
        KUHUL.on('#urlInput', 'keydown', (e) => { if (e.key === 'Enter') App.navigateURL(); });

        // Sidebar tabs
        KUHUL.dom.qa('.sidebar-tab').forEach(tab => {
          KUHUL.on(tab, 'click', () => App.switchSidebarView(tab.dataset.view));
        });

        // New tape
        KUHUL.on('#newTapeBtn', 'click', () => App.openTapeModal());
        KUHUL.on('#newTabBtn', 'click', () => App.promptNewTab());

        // Tape modal
        KUHUL.on('#tapeModalClose', 'click', () => App.closeModal('tapeModal'));
        KUHUL.on('#tapeModalCancel', 'click', () => App.closeModal('tapeModal'));
        KUHUL.on('#tapeModalSave', 'click', App.saveTape);

        // Settings modal
        KUHUL.on('#settingsBtn', 'click', () => App.openModal('settingsModal'));
        KUHUL.on('#settingsModalClose', 'click', () => App.closeModal('settingsModal'));
        KUHUL.on('#settingsSaveBtn', 'click', App.saveSettings);
        KUHUL.on('#importDataBtn', 'click', App.promptImport);

        // Export modal
        KUHUL.on('#exportBtn', 'click', App.openExportModal);
        KUHUL.on('#exportModalClose', 'click', () => App.closeModal('exportModal'));
        KUHUL.on('#copyExportBtn', 'click', App.copyExport);
        KUHUL.on('#downloadExportBtn', 'click', App.downloadExport);

        // Settings toggles
        KUHUL.dom.qa('.toggle').forEach(toggle => {
          KUHUL.on(toggle, 'click', () => toggle.classList.toggle('active'));
        });

        // Editor
        KUHUL.on('#editorSaveBtn', 'click', App.saveEditorAsTape);
        KUHUL.on('#editorRunBtn', 'click', App.runEditor);

        // Escape to close modals
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            App.closeModal('tapeModal');
            App.closeModal('settingsModal');
            App.closeModal('exportModal');
          }
        });
      },

      // Status
      setStatus(text) {
        KUHUL.dom.setText(App.el.statusText, text);
        KUHUL.dom.setText(App.el.statusChip, text.split(' ')[0]);
      },

      // Sync from SW
      sync(data) {
        if (data.tapes) App.state.tapes = data.tapes;
        if (data.endpoints) App.state.endpoints = data.endpoints;
        if (data.tabs) App.state.tabs = data.tabs;
        if (data.sessions) App.state.sessions = data.sessions;
        if (data.settings) App.state.settings = data.settings;

        App.renderTapes();
        App.renderEndpoints();

        if (data.dashboard) {
          const d = data.dashboard;
          KUHUL.dom.setText(App.el.storageInfo, `${d.totalTapes} tapes ‚Ä¢ ${d.storage?.usedMB || 0} MB`);
        }

        KUHUL.dom.setText(App.el.tabCount, `${App.state.tabs.length || 1} tab${App.state.tabs.length !== 1 ? 's' : ''}`);
      },

      // Sidebar view switching
      switchSidebarView(view) {
        KUHUL.dom.qa('.sidebar-tab').forEach(t => t.classList.toggle('active', t.dataset.view === view));
        KUHUL.dom.qa('.sidebar-view').forEach(v => v.style.display = v.id === `view-${view}` ? '' : 'none');
      },

      // Render tapes list
      renderTapes() {
        const html = App.state.tapes.map(tape => `
          <div class="tape-item" data-id="${tape.id}">
            <div class="tape-icon">${tape.icon || 'üìÑ'}</div>
            <div class="tape-info">
              <div class="tape-name">${KUHUL.clamp(tape.name, 30)}</div>
              <div class="tape-meta">${tape.sizeLabel} ‚Ä¢ ${tape.type}</div>
            </div>
            <div class="tape-actions">
              <button class="btn btn-sm btn-icon tape-open" title="Open">üìÇ</button>
              <button class="btn btn-sm btn-icon tape-edit" title="Edit">‚úèÔ∏è</button>
              <button class="btn btn-sm btn-icon tape-delete" title="Delete">üóëÔ∏è</button>
            </div>
          </div>
        `).join('');

        KUHUL.dom.setHTML(App.el.tapesList, html);

        // Bind tape actions
        KUHUL.dom.qa('.tape-item').forEach(item => {
          const id = item.dataset.id;
          KUHUL.on(item.querySelector('.tape-open'), 'click', (e) => { e.stopPropagation(); App.openTape(id); });
          KUHUL.on(item.querySelector('.tape-edit'), 'click', (e) => { e.stopPropagation(); App.editTape(id); });
          KUHUL.on(item.querySelector('.tape-delete'), 'click', (e) => { e.stopPropagation(); App.deleteTape(id); });
          KUHUL.on(item, 'click', () => App.openTape(id));
        });
      },

      // Render endpoints
      renderEndpoints() {
        const html = App.state.endpoints.map(ep => `
          <div class="tape-item" data-url="${ep.url}">
            <div class="tape-icon">üîó</div>
            <div class="tape-info">
              <div class="tape-name">${ep.name}</div>
              <div class="tape-meta">${ep.url}</div>
            </div>
          </div>
        `).join('');

        KUHUL.dom.setHTML(App.el.endpointsList, html);

        KUHUL.dom.qa('#endpointsList .tape-item').forEach(item => {
          KUHUL.on(item, 'click', () => {
            App.el.urlInput.value = item.dataset.url;
            App.navigateURL();
          });
        });
      },

      // Navigate URL
      navigateURL() {
        const url = App.el.urlInput.value.trim();
        if (!url) return;

        App.el.canvasLoading.classList.remove('hidden');

        if (url.startsWith('mx2db://')) {
          SW.send({ t: 'API_SEND', url, method: 'GET' });
        } else {
          SW.send({ t: 'CANVAS_PROJECT', url });
        }

        SW.send({ t: 'TAB_CREATE', url, opts: { title: url } });
      },

      // Render projection in canvas
      renderProjection(projection) {
        App.el.canvasLoading.classList.add('hidden');

        if (!projection.ok) {
          KUHUL.dom.setHTML(App.el.canvasContent, `
            <div style="color:var(--danger)">
              <h3>Projection Failed</h3>
              <p>${projection.error}</p>
              <p style="color:var(--fg-3);font-size:11px;margin-top:8px">URL: ${projection.url}</p>
            </div>
          `);
          return;
        }

        if (projection.renderer === 'json-view') {
          const data = KUHUL.parseJSON(projection.html, projection.html);
          KUHUL.dom.setHTML(App.el.canvasContent, `
            <pre style="color:var(--accent);white-space:pre-wrap;word-break:break-all">${
              typeof data === 'object' ? JSON.stringify(data, null, 2) : data
            }</pre>
          `);
        } else {
          // Render HTML safely (strip scripts)
          const clean = projection.html.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '');
          KUHUL.dom.setHTML(App.el.canvasContent, `
            <div style="background:#fff;color:#000;padding:16px;border-radius:8px;overflow:auto;max-height:100%">
              ${clean}
            </div>
          `);
        }
      },

      // Show API response
      showAPIResponse(result) {
        App.el.canvasLoading.classList.add('hidden');

        if (result.error) {
          KUHUL.dom.setHTML(App.el.canvasContent, `
            <div style="color:var(--danger)">
              <h3>API Error</h3>
              <p>${result.error}</p>
            </div>
          `);
          return;
        }

        const data = typeof result.data === 'object' ? JSON.stringify(result.data, null, 2) : result.data;
        KUHUL.dom.setHTML(App.el.canvasContent, `
          <div style="color:var(--fg-2);margin-bottom:12px">
            <span style="color:var(--success)">‚óè</span> ${result.status} ${result.statusText || ''} ‚Ä¢ ${result.time}ms
          </div>
          <pre style="color:var(--accent);white-space:pre-wrap;word-break:break-all">${data}</pre>
        `);
      },

      // Tab management
      addTab(tab, session) {
        const tabEl = document.createElement('div');
        tabEl.className = 'canvas-tab';
        tabEl.dataset.tab = tab.id;
        tabEl.innerHTML = `
          <span class="canvas-tab-title">${KUHUL.clamp(session?.title || session?.url || 'New Tab', 20)}</span>
          <button class="canvas-tab-close">‚úï</button>
        `;

        // Insert before + button
        App.el.canvasTabs.insertBefore(tabEl, KUHUL.dom.byId('newTabBtn'));

        // Bind events
        KUHUL.on(tabEl, 'click', () => App.activateTab(tab.id));
        KUHUL.on(tabEl.querySelector('.canvas-tab-close'), 'click', (e) => {
          e.stopPropagation();
          App.closeTab(tab.id);
        });

        // Make draggable
        tabEl.draggable = true;
        KUHUL.on(tabEl, 'dragstart', (e) => {
          e.dataTransfer.setData('text/plain', tab.id);
          tabEl.classList.add('dragging');
        });
        KUHUL.on(tabEl, 'dragend', () => tabEl.classList.remove('dragging'));
        KUHUL.on(tabEl, 'dragover', (e) => {
          e.preventDefault();
          tabEl.classList.add('drag-over');
        });
        KUHUL.on(tabEl, 'dragleave', () => tabEl.classList.remove('drag-over'));
        KUHUL.on(tabEl, 'drop', (e) => {
          e.preventDefault();
          tabEl.classList.remove('drag-over');
          const draggedId = e.dataTransfer.getData('text/plain');
          if (draggedId !== tab.id) {
            const order = Array.from(App.el.canvasTabs.querySelectorAll('.canvas-tab:not(.canvas-new)')).indexOf(tabEl);
            SW.send({ t: 'TAB_REORDER', id: draggedId, order });
          }
        });

        App.activateTab(tab.id);
      },

      activateTab(id) {
        KUHUL.dom.qa('.canvas-tab').forEach(t => t.classList.toggle('active', t.dataset.tab === id));
        App.state.activeTabId = id;
        SW.send({ t: 'TAB_ACTIVATE', id });
      },

      closeTab(id) {
        SW.send({ t: 'TAB_CLOSE', id });
      },

      removeTab(id) {
        const tab = KUHUL.dom.q(`.canvas-tab[data-tab="${id}"]`);
        if (tab) tab.remove();
      },

      promptNewTab() {
        const url = prompt('Enter URL:');
        if (url) {
          App.el.urlInput.value = url;
          App.navigateURL();
        }
      },

      // Tape CRUD
      openTape(id) {
        SW.send({ t: 'TAPE_OPEN', id });
      },

      openTapeContent(tape) {
        App.el.editorArea.value = tape.content;
        App.switchSidebarView('editor');

        KUHUL.dom.setHTML(App.el.canvasContent, `
          <h3 style="margin-bottom:12px">${tape.name}</h3>
          <pre style="color:var(--fg-1);white-space:pre-wrap">${KUHUL.clamp(tape.content, 10000)}</pre>
        `);
      },

      editTape(id) {
        const tape = App.state.tapes.find(t => t.id === id);
        if (!tape) return;

        App.state.editingTapeId = id;
        App.openTapeModal(tape);
        SW.send({ t: 'TAPE_OPEN', id });
      },

      deleteTape(id) {
        if (confirm('Delete this tape?')) {
          SW.send({ t: 'TAPE_DELETE', id });
        }
      },

      openTapeModal(tape = null) {
        App.state.editingTapeId = tape?.id || null;
        KUHUL.dom.setText(KUHUL.dom.byId('tapeModalTitle'), tape ? 'Edit Tape' : 'New Tape');

        KUHUL.dom.byId('tapeName').value = tape?.name || '';
        KUHUL.dom.byId('tapeType').value = tape?.type || 'json';
        KUHUL.dom.byId('tapeCompression').value = tape?.compression || 'none';
        KUHUL.dom.byId('tapeTags').value = (tape?.tags || []).join(', ');
        KUHUL.dom.byId('tapeContent').value = tape?.content || '';

        App.openModal('tapeModal');
      },

      saveTape() {
        const name = KUHUL.dom.byId('tapeName').value.trim();
        const type = KUHUL.dom.byId('tapeType').value;
        const compression = KUHUL.dom.byId('tapeCompression').value;
        const tags = KUHUL.dom.byId('tapeTags').value;
        const content = KUHUL.dom.byId('tapeContent').value;

        if (!name) {
          alert('Name is required');
          return;
        }

        if (App.state.editingTapeId) {
          SW.send({
            t: 'TAPE_UPDATE',
            id: App.state.editingTapeId,
            updates: { name, type, compression, tags, content }
          });
        } else {
          SW.send({ t: 'TAPE_CREATE', name, type, compression, tags, content });
        }

        App.closeModal('tapeModal');
      },

      saveEditorAsTape() {
        const content = App.el.editorArea.value;
        const name = prompt('Save as:', `code-${Date.now()}.txt`);
        if (name) {
          SW.send({ t: 'EDITOR_SAVE_AS_TAPE', name, content, type: 'text' });
        }
      },

      runEditor() {
        const code = App.el.editorArea.value;
        try {
          // Safe eval in console only
          KUHUL.log.info('Running code...');
          const result = (new Function('KUHUL', code))(KUHUL);
          KUHUL.log.info('Result:', result);
        } catch (err) {
          KUHUL.log.error('Run error:', err);
        }
      },

      // Settings
      saveSettings() {
        const updates = {};
        KUHUL.dom.qa('.toggle[data-setting]').forEach(toggle => {
          updates[toggle.dataset.setting] = toggle.classList.contains('active');
        });
        SW.send({ t: 'SETTINGS_UPDATE', updates });
        App.closeModal('settingsModal');
      },

      // Export/Import
      openExportModal() {
        App.openModal('exportModal');
        SW.send({ t: 'TAPE_EXPORT_ALL', compress: KUHUL.dom.byId('exportFormat').value === 'scxq2' });
      },

      showExportData(data) {
        KUHUL.dom.byId('exportData').value = data;
      },

      copyExport() {
        const data = KUHUL.dom.byId('exportData').value;
        navigator.clipboard.writeText(data).then(() => {
          App.setStatus('Copied to clipboard');
        });
      },

      downloadExport() {
        const data = KUHUL.dom.byId('exportData').value;
        const format = KUHUL.dom.byId('exportFormat').value;
        const blob = new Blob([data], { type: 'application/octet-stream' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `blackcode-export-${Date.now()}.${format === 'scxq2' ? 'scxq2' : 'json'}`;
        a.click();
        URL.revokeObjectURL(url);
      },

      promptImport() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json,.scxq2';
        input.onchange = async (e) => {
          const file = e.target.files[0];
          if (!file) return;
          const data = await file.text();
          const merge = confirm('Merge with existing data? (Cancel to replace)');
          SW.send({ t: 'TAPE_IMPORT', data, merge });
        };
        input.click();
      },

      handleImportResult(msg) {
        if (msg.ok) {
          App.setStatus(`Imported ${msg.imported} tapes`);
          App.closeModal('settingsModal');
        } else {
          alert('Import failed: ' + msg.error);
        }
      },

      // Modals
      openModal(id) {
        KUHUL.dom.byId(id).classList.add('active');
      },

      closeModal(id) {
        KUHUL.dom.byId(id).classList.remove('active');
      },

      // SVG wave animation
      initSVGWave() {
        const svg = KUHUL.dom.byId('kuhul_svg_root');
        if (!svg) return;

        let frame = 0;
        const animate = () => {
          frame++;
          const w = svg.clientWidth || 400;
          const h = svg.clientHeight || 120;

          let d = `M 0 ${h/2}`;
          for (let x = 0; x <= w; x += 8) {
            const y = (h/2) + Math.sin((x + frame * 2) / 30) * (h/3) * Math.sin(frame / 100);
            d += ` L ${x} ${y}`;
          }

          svg.innerHTML = `
            <defs>
              <linearGradient id="waveGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" style="stop-color:#16f2aa" />
                <stop offset="100%" style="stop-color:#61e7ff" />
              </linearGradient>
            </defs>
            <path d="${d}" fill="none" stroke="url(#waveGrad)" stroke-width="2" stroke-linecap="round"/>
          `;

          requestAnimationFrame(animate);
        };

        animate();
      },

      // Render canvas frame (from SW animation loop)
      renderFrame(state) {
        // Could update tick counter or other visualizations
      }
    };

    // Boot
    document.addEventListener('DOMContentLoaded', () => App.init());

  })();
  </script>
</body>
</html>
