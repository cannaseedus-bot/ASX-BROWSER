<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MX2LM OS ‚Äî PWA BUILDER & AI INFERENCE</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#16f2aa">

  <!-- =========================================================
       BLOCK 1 ‚Äî TOKENS & RESET
       ========================================================= -->
  <style>
    :root {
      --bg-primary: #020617;
      --bg-secondary: #050b1c;
      --bg-tertiary: #0a0f14;
      --bg-surface: #101820;
      --text-primary: #e6fffa;
      --text-secondary: #7dd3fc;
      --text-muted: #5d8ba3;
      --emerald: #16f2aa;
      --emerald-soft: rgba(22, 242, 170, 0.13);
      --emerald-strong: rgba(22, 242, 170, 0.22);
      --cyan: #22d3ee;
      --cyan-soft: rgba(34, 211, 238, 0.16);
      --accent-warning: #ffd166;
      --accent-danger: #ff3366;
      --accent-success: #00d9a6;
      --sp-xs: 4px;
      --sp-sm: 8px;
      --sp-md: 16px;
      --sp-lg: 24px;
      --sp-xl: 32px;
      --sp-2xl: 48px;
      --rad-sm: 8px;
      --rad-md: 12px;
      --rad-lg: 16px;
      --rad-xl: 20px;
      --rad-2xl: 24px;
      --rad-pill: 999px;
      --font-sans: system-ui, -apple-system, BlinkMacSystemFont, "Inter", sans-serif;
      --font-mono: "JetBrains Mono", "Fira Code", monospace;
      --size-xs: 11px;
      --size-sm: 13px;
      --size-md: 14px;
      --size-lg: 16px;
      --size-xl: 20px;
      --size-2xl: 24px;
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.4);
      --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.5);
      --shadow-glow: 0 0 40px rgba(22, 242, 170, 0.25);
      --trans-fast: 0.15s ease;
      --trans-normal: 0.3s ease;
      --trans-slow: 0.5s ease;
      --bg-panel: rgba(15, 23, 42, 0.98);
      --border-ui: rgba(148, 163, 184, 0.45);
    }
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{width:100%;height:100%}
    body{font-family:var(--font-sans);color:var(--text-primary);background:radial-gradient(circle at 5% 0%,rgba(34,211,238,0.12) 0,transparent 55%),radial-gradient(circle at 95% 100%,rgba(16,185,129,0.12) 0,transparent 55%),radial-gradient(circle at 50% 50%,rgba(15,23,42,1) 0,#020617 60%);color-scheme:dark;overflow:hidden}
  </style>

  <!-- =========================================================
       BLOCK 2 ‚Äî BASE & ATOMIC COMPONENTS
       ========================================================= -->
  <style>
    h1,h2,h3,h4,h5,h6{font-weight:600;line-height:1.2}
    h1{font-size:var(--size-2xl)}h2{font-size:var(--size-xl)}h3{font-size:var(--size-lg)}
    p{line-height:1.6;color:var(--text-secondary)}
    a{color:var(--emerald);text-decoration:none;transition:color var(--trans-fast)}
    a:hover{color:var(--cyan);text-decoration:underline}
    input,textarea,select{font-family:inherit;font-size:inherit;color:var(--text-primary);background:rgba(15,23,42,0.95);border:1px solid rgba(148,163,184,0.45);border-radius:var(--rad-md);padding:var(--sp-sm) var(--sp-md);transition:border-color var(--trans-fast),box-shadow var(--trans-fast)}
    input:focus,textarea:focus,select:focus{outline:none;border-color:var(--emerald);box-shadow:0 0 16px rgba(22,242,170,0.3);background:rgba(15,23,42,0.98)}
    .asx-btn{border-radius:var(--rad-pill);padding:7px 14px;font-size:var(--size-sm);display:inline-flex;align-items:center;gap:6px;cursor:pointer;border:1px solid rgba(148,163,184,0.55);background:linear-gradient(145deg,rgba(15,23,42,0.96),rgba(15,23,42,0.88));color:var(--text-primary);transition:transform var(--trans-fast),box-shadow var(--trans-fast),background var(--trans-fast);outline:none;white-space:nowrap}
    .asx-btn:hover{transform:translateY(-1px);box-shadow:var(--shadow-sm);background:linear-gradient(145deg,rgba(15,23,42,0.98),rgba(15,23,42,0.92))}
    .asx-btn-primary{background:radial-gradient(circle at 0 0,rgba(45,212,191,0.24),transparent 55%),linear-gradient(140deg,rgba(15,23,42,0.98),rgba(16,185,129,0.25));border-color:rgba(45,212,191,0.9);box-shadow:var(--shadow-glow)}
    .asx-btn-primary:hover{box-shadow:0 0 32px rgba(22,242,170,0.5)}
    .asx-btn-danger{border-color:var(--accent-danger);color:var(--accent-danger)}
    .asx-btn-danger:hover{background:rgba(255,51,102,0.15)}
    .chip{border-radius:var(--rad-pill);padding:5px 10px;font-size:var(--size-xs);display:inline-flex;align-items:center;gap:6px;border:1px solid rgba(148,163,184,0.45);background:linear-gradient(135deg,rgba(15,23,42,0.95),rgba(15,23,42,0.8));color:var(--text-primary)}
    .chip-dot{width:8px;height:8px;border-radius:999px;background:var(--accent-success);box-shadow:0 0 12px rgba(0,217,166,0.7)}
    .panel{border-radius:var(--rad-xl);padding:var(--sp-md);background:radial-gradient(circle at 0 0,rgba(34,211,238,0.22),transparent 55%),linear-gradient(145deg,rgba(15,23,42,0.98),rgba(15,23,42,0.88));border:1px solid rgba(148,163,184,0.6);box-shadow:var(--shadow-md);backdrop-filter:blur(22px);display:flex;flex-direction:column;min-height:0}
    .card{border-radius:var(--rad-lg);padding:var(--sp-md);background:radial-gradient(circle at 0 0,rgba(34,211,238,0.18),transparent 55%),linear-gradient(145deg,rgba(15,23,42,0.98),rgba(15,23,42,0.9));border:1px solid rgba(148,163,184,0.6);box-shadow:var(--shadow-md);backdrop-filter:blur(22px);transition:transform var(--trans-normal),box-shadow var(--trans-normal)}
    .card:hover{transform:translateY(-3px);box-shadow:var(--shadow-lg),var(--shadow-glow)}
    .section-title{font-size:var(--size-md);font-weight:600;display:flex;justify-content:space-between;align-items:center;gap:var(--sp-sm);margin-bottom:var(--sp-sm)}
    .section-subtitle{font-size:var(--size-xs);color:var(--text-muted);margin-bottom:var(--sp-sm)}
    .pill-tabs{display:inline-flex;padding:3px;border-radius:var(--rad-pill);border:1px solid rgba(148,163,184,0.5);background:rgba(15,23,42,0.9);gap:3px}
    .pill-tab{border-radius:var(--rad-pill);border:none;background:transparent;color:var(--text-secondary);font-size:var(--size-xs);padding:4px 10px;cursor:pointer;transition:background var(--trans-fast),color var(--trans-fast)}
    .pill-tab.active{background:rgba(15,23,42,0.98);color:var(--text-primary);box-shadow:0 0 0 1px rgba(148,163,184,0.6)}
  </style>

  <!-- =========================================================
       BLOCK 3 ‚Äî LAYOUTS
       ========================================================= -->
  <style>
    #glyph-rain{position:fixed;inset:0;width:100%;height:100%;z-index:0;pointer-events:none;opacity:0.6}
    #ghost-root{position:relative;z-index:1;height:100vh;display:flex;flex-direction:column}
    .ghost-header{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:radial-gradient(circle at 0 0,rgba(34,211,238,0.28),transparent 55%),linear-gradient(120deg,rgba(15,23,42,0.96),rgba(15,23,42,0.86));border-bottom:1px solid rgba(148,163,184,0.55);box-shadow:0 8px 24px rgba(15,23,42,0.95),0 0 32px rgba(22,242,170,0.15);backdrop-filter:blur(20px);flex-shrink:0}
    .ghost-header-left{display:flex;align-items:center;gap:var(--sp-sm)}
    .ghost-logo{width:32px;height:32px;border-radius:999px;display:flex;align-items:center;justify-content:center;background:radial-gradient(circle at 0 0,rgba(45,212,191,0.28),transparent 55%),linear-gradient(145deg,rgba(15,23,42,0.98),rgba(15,23,42,0.9));border:1px solid rgba(45,212,191,0.8);font-size:18px}
    .ghost-header-title{display:flex;flex-direction:column;font-size:var(--size-xs)}
    .ghost-header-title strong{font-size:var(--size-sm)}
    .ghost-header-right{display:flex;align-items:center;gap:var(--sp-sm);flex-wrap:wrap;justify-content:flex-end}
    .url-form{display:flex;gap:var(--sp-sm);align-items:center;flex:1;max-width:600px;margin:0 var(--sp-md)}
    .url-input{flex:1;border-radius:var(--rad-pill);padding:8px 16px;font-size:var(--size-sm);background:rgba(15,23,42,0.9);border:1px solid rgba(148,163,184,0.5);color:var(--text-primary)}
    .url-input:focus{border-color:var(--emerald);box-shadow:0 0 16px rgba(22,242,170,0.3)}
    .ghost-main{display:flex;flex:1;min-height:0;overflow:hidden}
    .pwa-sidebar{width:320px;min-width:320px;display:flex;flex-direction:column;border-right:1px solid rgba(148,163,184,0.55);background:linear-gradient(145deg,#020617,#050b1c);overflow:hidden}
    .pwa-sidebar-header{padding:var(--sp-md);border-bottom:1px solid rgba(148,163,184,0.4)}
    .pwa-sidebar-tabs{display:flex;border-radius:var(--rad-md);border:1px solid rgba(148,163,184,0.5);padding:2px;gap:2px}
    .pwa-sidebar-tab{flex:1;border-radius:var(--rad-sm);border:none;background:transparent;color:var(--text-secondary);font-size:var(--size-xs);padding:6px;cursor:pointer;text-align:center;transition:background var(--trans-fast),color var(--trans-fast)}
    .pwa-sidebar-tab.active{background:rgba(15,23,42,0.98);color:var(--text-primary);box-shadow:0 0 0 1px rgba(148,163,184,0.6)}
    .pwa-sidebar-body{flex:1;display:flex;flex-direction:column;min-height:0;overflow-y:auto}
    .pwa-editor-container{flex:1;display:none;flex-direction:column;min-height:0}
    .pwa-editor-container.active{display:flex}
    .pwa-editor-header{padding:var(--sp-sm) var(--sp-md);border-bottom:1px solid rgba(51,65,85,0.9);display:flex;justify-content:space-between;align-items:center;font-size:var(--size-xs);color:var(--text-muted)}
    .pwa-editor-body{flex:1;padding:var(--sp-md);overflow-y:auto;font-family:var(--font-mono);font-size:var(--size-sm);line-height:1.5;color:rgba(226,232,240,0.9);background:linear-gradient(145deg,#020617,#020617)}
    .pwa-editor-footer{padding:var(--sp-sm) var(--sp-md);border-top:1px solid rgba(30,64,175,0.6);display:flex;justify-content:space-between;font-size:var(--size-xs);color:var(--text-muted)}
    .projects-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:var(--sp-sm);padding:var(--sp-md)}
    .project-card{padding:var(--sp-sm);border-radius:var(--rad-md);background:linear-gradient(145deg,rgba(15,23,42,0.9),rgba(15,23,42,0.8));border:1px solid rgba(148,163,184,0.4);cursor:pointer;transition:all var(--trans-fast)}
    .project-card:hover{border-color:var(--emerald);transform:translateY(-2px);box-shadow:var(--shadow-sm)}
    .project-card.active{border-color:var(--emerald);background:linear-gradient(145deg,rgba(22,242,170,0.15),rgba(15,23,42,0.9))}
    .dashboard-main{flex:1;padding:var(--sp-md);overflow-y:auto;display:flex;flex-direction:column;gap:var(--sp-lg)}
    .dashboard-hero{display:grid;grid-template-columns:1fr 1fr;gap:var(--sp-lg)}
    .hero-cta{padding:var(--sp-xl);border-radius:var(--rad-2xl);background:radial-gradient(circle at 0 0,rgba(34,211,238,0.22),transparent 55%),linear-gradient(145deg,rgba(15,23,42,0.98),rgba(15,23,42,0.88));border:1px solid rgba(148,163,184,0.6);box-shadow:var(--shadow-lg);display:flex;flex-direction:column;justify-content:center}
    .hero-cta h1{font-size:var(--size-2xl);margin-bottom:var(--sp-sm);background:linear-gradient(135deg,var(--text-primary),var(--emerald));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .hero-cta p{margin-bottom:var(--sp-lg);font-size:var(--size-md);max-width:80%}
    .hero-stats{display:grid;grid-template-columns:1fr 1fr;gap:var(--sp-md)}
    .stat-card{padding:var(--sp-lg);border-radius:var(--rad-xl);background:linear-gradient(145deg,rgba(15,23,42,0.95),rgba(15,23,42,0.85));border:1px solid rgba(148,163,184,0.5);display:flex;flex-direction:column;align-items:center;text-align:center}
    .stat-number{font-size:var(--size-2xl);font-weight:bold;background:linear-gradient(135deg,var(--emerald),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:var(--sp-xs)}
    .stat-label{font-size:var(--size-xs);color:var(--text-muted)}
    .dashboard-highlights{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:var(--sp-md)}
    .highlight-card{padding:var(--sp-lg);border-radius:var(--rad-xl);background:linear-gradient(145deg,rgba(15,23,42,0.95),rgba(15,23,42,0.85));border:1px solid rgba(148,163,184,0.5);transition:transform var(--trans-normal),box-shadow var(--trans-normal)}
    .highlight-card:hover{transform:translateY(-5px);box-shadow:var(--shadow-lg),var(--shadow-glow)}
    .highlight-icon{width:40px;height:40px;border-radius:var(--rad-md);background:linear-gradient(135deg,var(--emerald-soft),var(--cyan-soft));display:flex;align-items:center;justify-content:center;margin-bottom:var(--sp-md);font-size:var(--size-lg)}
    .highlight-card h3{margin-bottom:var(--sp-sm)}
    .pwa-settings-panel{padding:var(--sp-md)}
    .pwa-setting-group{margin-bottom:var(--sp-md)}
    .pwa-setting-label{display:block;font-size:var(--size-xs);font-weight:600;margin-bottom:var(--sp-xs);color:var(--text-secondary)}
    .chat-inference{margin-top:var(--sp-lg)}
    .chat-stream{height:300px;border-radius:var(--rad-lg);border:1px solid rgba(148,163,184,0.55);padding:var(--sp-md);overflow-y:auto;display:flex;flex-direction:column;gap:var(--sp-sm);font-size:var(--size-sm);background:linear-gradient(145deg,rgba(15,23,42,0.98),rgba(15,23,42,0.92));margin-bottom:var(--sp-md)}
    .chat-msg{padding:var(--sp-sm);border-radius:var(--rad-md);border:1px solid rgba(148,163,184,0.45);max-width:80%}
    .chat-msg.user{align-self:flex-end;background:rgba(16,185,129,0.09);border-color:rgba(16,185,129,0.8)}
    .chat-msg.assistant{align-self:flex-start;background:rgba(15,23,42,0.95)}
    .chat-input-row{display:flex;gap:var(--sp-sm)}
    .chat-input{flex:1;border-radius:var(--rad-lg)}
    .ai-thinking{display:flex;align-items:center;gap:6px;padding:var(--sp-sm);color:var(--emerald);font-size:var(--size-xs)}
    .ai-dot{width:6px;height:6px;border-radius:50%;background:var(--emerald);animation:pulse 1.5s infinite}
    .ai-dot:nth-child(2){animation-delay:0.2s}
    .ai-dot:nth-child(3){animation-delay:0.4s}
    @keyframes pulse{0%,100%{opacity:0.3;transform:scale(1)}50%{opacity:1;transform:scale(1.2)}}
    .preview-panel{display:flex;flex-direction:column;height:100%}
    .preview-frame{flex:1;border-radius:var(--rad-md);border:1px solid rgba(148,163,184,0.5);background:white;overflow:hidden;margin-top:var(--sp-sm)}
    .modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(2,6,23,0.9);z-index:2000;display:none;align-items:center;justify-content:center;backdrop-filter:blur(10px)}
    .modal-overlay.active{display:flex}
    .modal-content{width:90%;max-width:500px;max-height:90vh;background:linear-gradient(145deg,rgba(15,23,42,0.98),rgba(15,23,42,0.92));border:1px solid rgba(148,163,184,0.6);border-radius:var(--rad-xl);box-shadow:var(--shadow-lg),var(--shadow-glow);display:flex;flex-direction:column;overflow:hidden}
    .modal-header{padding:var(--sp-md);border-bottom:1px solid rgba(148,163,184,0.4);display:flex;justify-content:space-between;align-items:center}
    .modal-body{padding:var(--sp-md);overflow-y:auto;flex:1}
    .modal-footer{padding:var(--sp-md);border-top:1px solid rgba(148,163,184,0.4);display:flex;justify-content:flex-end;gap:var(--sp-sm)}
    @media(max-width:1100px){.dashboard-hero{grid-template-columns:1fr}.hero-stats{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:768px){.ghost-main{flex-direction:column}.pwa-sidebar{width:100%;min-width:100%;height:300px}.dashboard-main{height:auto}}
  </style>

  <!-- =========================================================
       BLOCK 4 ‚Äî UTILITIES
       ========================================================= -->
  <style>
    .flex{display:flex}.flex-col{flex-direction:column}.flex-row{flex-direction:row}
    .flex-center{justify-content:center;align-items:center}.flex-between{justify-content:space-between;align-items:center}
    .flex-wrap{flex-wrap:wrap}.gap-xs{gap:var(--sp-xs)}.gap-sm{gap:var(--sp-sm)}.gap-md{gap:var(--sp-md)}.gap-lg{gap:var(--sp-lg)}
    .mt-xs{margin-top:var(--sp-xs)}.mt-sm{margin-top:var(--sp-sm)}.mt-md{margin-top:var(--sp-md)}.mt-lg{margin-top:var(--sp-lg)}
    .text-xs{font-size:var(--size-xs)}.text-sm{font-size:var(--size-sm)}.text-md{font-size:var(--size-md)}.text-lg{font-size:var(--size-lg)}
    .text-muted{color:var(--text-muted)}.text-secondary{color:var(--text-secondary)}
    .overflow-y-auto{overflow-y:auto}.hidden{display:none!important}.w-full{width:100%}
  </style>
</head>
<body>
  <canvas id="glyph-rain"></canvas>

  <!-- Modals -->
  <div class="modal-overlay" id="exportModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="section-title">Export PWA Files</div>
        <button class="asx-btn" onclick="KUHUL.app.hideModal('exportModal')">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="text-sm text-muted">Download your PWA files:</div>
        <div class="mt-md flex-col gap-sm" id="exportFilesList"></div>
      </div>
      <div class="modal-footer">
        <button class="asx-btn" onclick="KUHUL.app.hideModal('exportModal')">Cancel</button>
        <button class="asx-btn asx-btn-primary" onclick="KUHUL.app.downloadAllFiles()">Download All</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="newProjectModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="section-title">New PWA Project</div>
        <button class="asx-btn" onclick="KUHUL.app.hideModal('newProjectModal')">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="pwa-setting-group">
          <label class="pwa-setting-label">Project Name</label>
          <input type="text" class="url-input w-full" id="projectName" placeholder="My Awesome PWA">
        </div>
        <div class="pwa-setting-group">
          <label class="pwa-setting-label">Description</label>
          <textarea class="url-input w-full" id="projectDescription" rows="3" placeholder="Describe your PWA..."></textarea>
        </div>
        <div class="pwa-setting-group">
          <label class="pwa-setting-label">Template</label>
          <select class="url-input w-full" id="projectTemplate">
            <option value="basic">Basic PWA</option>
            <option value="dashboard">Dashboard App</option>
            <option value="ecommerce">E-commerce</option>
            <option value="blog">Blog/CMS</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="asx-btn" onclick="KUHUL.app.hideModal('newProjectModal')">Cancel</button>
        <button class="asx-btn asx-btn-primary" onclick="KUHUL.app.createNewProject()">Create Project</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="aiResponseModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="section-title">AI Suggestions</div>
        <button class="asx-btn" onclick="KUHUL.app.hideModal('aiResponseModal')">‚úï</button>
      </div>
      <div class="modal-body" id="aiResponseContent"></div>
      <div class="modal-footer">
        <button class="asx-btn" onclick="KUHUL.app.hideModal('aiResponseModal')">Cancel</button>
        <button class="asx-btn asx-btn-primary" onclick="KUHUL.app.applyAiChanges()">Apply Changes</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="settingsModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="section-title">AI Settings</div>
        <button class="asx-btn" onclick="KUHUL.app.hideModal('settingsModal')">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="pwa-setting-group">
          <label class="pwa-setting-label">Ollama API Endpoint</label>
          <input type="text" class="url-input w-full" id="ollamaEndpoint" value="http://localhost:11434/api/generate">
        </div>
        <div class="pwa-setting-group">
          <label class="pwa-setting-label">Model Name</label>
          <input type="text" class="url-input w-full" id="ollamaModel" value="llama2">
        </div>
        <div class="pwa-setting-group">
          <label class="pwa-setting-label">OpenAI API Key (optional)</label>
          <input type="password" class="url-input w-full" id="openaiKey" placeholder="sk-...">
        </div>
      </div>
      <div class="modal-footer">
        <button class="asx-btn" onclick="KUHUL.app.hideModal('settingsModal')">Cancel</button>
        <button class="asx-btn asx-btn-primary" onclick="KUHUL.app.saveAiSettings()">Save</button>
      </div>
    </div>
  </div>

  <div id="ghost-root" data-os="mx2lm_pwa_builder">
    <!-- HEADER -->
    <header class="ghost-header">
      <div class="ghost-header-left">
        <div class="ghost-logo">‚üÅ</div>
        <div class="ghost-header-title">
          <strong>MX2LM OS ‚Äî PWA BUILDER</strong>
          <span class="text-xs text-muted">AI-Powered PWA Development</span>
        </div>
      </div>

      <div class="url-form">
        <input type="text" class="url-input" id="urlInput" placeholder="Enter API URL to test...">
        <button class="asx-btn asx-btn-primary" id="urlOpenBtn">Test</button>
      </div>

      <div class="ghost-header-right">
        <div class="chip">
          <div class="chip-dot"></div>
          <span id="currentProjectDisplay">default</span>
        </div>
        <button class="asx-btn" id="aiSettingsBtn">AI Settings</button>
        <button class="asx-btn asx-btn-primary" id="exportPwaBtn">Export</button>
      </div>
    </header>

    <!-- MAIN LAYOUT -->
    <main class="ghost-main">
      <!-- PWA BUILDER SIDEBAR -->
      <aside class="pwa-sidebar" id="pwaSidebar">
        <div class="pwa-sidebar-header">
          <div class="section-title">
            <span>PWA Projects</span>
            <button class="asx-btn" style="font-size:var(--size-xs);padding:4px 8px" onclick="KUHUL.app.showModal('newProjectModal')">+ New</button>
          </div>
          <div class="pwa-sidebar-tabs mt-sm">
            <button class="pwa-sidebar-tab active" data-target="projects">Projects</button>
            <button class="pwa-sidebar-tab" data-target="files">Files</button>
            <button class="pwa-sidebar-tab" data-target="settings">Settings</button>
            <button class="pwa-sidebar-tab" data-target="preview">Preview</button>
          </div>
        </div>

        <div class="pwa-sidebar-body">
          <!-- Projects Tab -->
          <div class="pwa-editor-container active" id="pwa-projects">
            <div class="projects-grid" id="projectsGrid"></div>
            <div class="pwa-editor-footer">
              <span id="projectsCount">0 projects</span>
              <button class="asx-btn" style="padding:2px 8px;font-size:var(--size-xs)" onclick="KUHUL.app.importProject()">Import</button>
            </div>
          </div>

          <!-- Files Tab -->
          <div class="pwa-editor-container" id="pwa-files">
            <div class="pwa-editor-header">
              <span>PWA Files (3-File Rule)</span>
            </div>
            <div class="pwa-editor-body">
              <div class="flex-col gap-sm">
                <button class="asx-btn" onclick="KUHUL.app.switchFile('manifest')">üìÑ manifest.json</button>
                <button class="asx-btn" onclick="KUHUL.app.switchFile('sw')">‚ö° sw.js</button>
                <button class="asx-btn" onclick="KUHUL.app.switchFile('index')">üåê index.html</button>
              </div>
              <div class="mt-md">
                <div class="section-title">Quick Actions</div>
                <div class="flex-col gap-xs">
                  <button class="asx-btn" onclick="KUHUL.app.saveAllFiles()">üíæ Save All</button>
                  <button class="asx-btn" onclick="KUHUL.app.updatePreview()">üîç Update Preview</button>
                  <button class="asx-btn" onclick="KUHUL.app.optimizeWithAI()">ü§ñ Optimize with AI</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Settings Tab -->
          <div class="pwa-editor-container" id="pwa-settings">
            <div class="pwa-settings-panel">
              <div class="pwa-setting-group">
                <label class="pwa-setting-label">App Name</label>
                <input type="text" class="url-input w-full" id="pwaName" value="My PWA App">
              </div>
              <div class="pwa-setting-group">
                <label class="pwa-setting-label">Short Name</label>
                <input type="text" class="url-input w-full" id="pwaShortName" value="PWA App">
              </div>
              <div class="pwa-setting-group">
                <label class="pwa-setting-label">Theme Color</label>
                <input type="color" class="url-input w-full" id="pwaThemeColor" value="#16f2aa" style="height:40px;padding:4px">
              </div>
              <div class="pwa-setting-group">
                <label class="pwa-setting-label">Background Color</label>
                <input type="color" class="url-input w-full" id="pwaBgColor" value="#020409" style="height:40px;padding:4px">
              </div>
              <button class="asx-btn asx-btn-primary w-full mt-md" onclick="KUHUL.app.savePwaSettings()">Save Settings</button>
            </div>
          </div>

          <!-- Preview Tab -->
          <div class="pwa-editor-container" id="pwa-preview">
            <div class="preview-panel">
              <div class="section-title">Live Preview</div>
              <div class="section-subtitle">Real-time PWA preview</div>
              <iframe class="preview-frame" id="previewFrame" sandbox="allow-scripts allow-forms allow-same-origin"></iframe>
            </div>
          </div>
        </div>
      </aside>

      <!-- DASHBOARD MAIN AREA -->
      <section class="dashboard-main">
        <!-- HERO -->
        <div class="dashboard-hero">
          <div class="hero-cta">
            <h1>PWA Builder with AI</h1>
            <p>Build Progressive Web Apps with AI assistance using Ollama or OpenAI. The 3-file rule: manifest.json, sw.js, index.html.</p>
            <div class="flex gap-md mt-md">
              <button class="asx-btn asx-btn-primary" onclick="KUHUL.app.showModal('newProjectModal')">Create New PWA</button>
              <button class="asx-btn" onclick="KUHUL.app.importProject()">Import Project</button>
              <button class="asx-btn" onclick="KUHUL.app.showModal('exportModal')">Export Files</button>
            </div>
          </div>
          <div class="hero-stats">
            <div class="stat-card">
              <div class="stat-number" id="totalProjects">0</div>
              <div class="stat-label">Projects</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">3</div>
              <div class="stat-label">Core Files</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="aiStatus">Ready</div>
              <div class="stat-label">AI Status</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">100%</div>
              <div class="stat-label">PWA Score</div>
            </div>
          </div>
        </div>

        <!-- EDITOR AREA -->
        <div>
          <div class="section-title">
            <span>PWA File Editor</span>
            <div class="pill-tabs" id="file-tabs">
              <button class="pill-tab active" data-file="manifest">manifest.json</button>
              <button class="pill-tab" data-file="sw">sw.js</button>
              <button class="pill-tab" data-file="index">index.html</button>
            </div>
          </div>
          <div class="mt-md">
            <textarea class="url-input w-full" id="editorContent" rows="15" style="font-family:var(--font-mono);font-size:var(--size-sm)"></textarea>
          </div>
          <div class="flex-between mt-sm">
            <div class="text-xs text-muted" id="fileInfo">manifest.json ‚Ä¢ 0 characters</div>
            <div class="flex gap-xs">
              <button class="asx-btn" onclick="KUHUL.app.saveCurrentFile()">üíæ Save</button>
              <button class="asx-btn" onclick="KUHUL.app.formatCurrentFile()">‚ú® Format</button>
              <button class="asx-btn asx-btn-primary" onclick="KUHUL.app.askAiForHelp()">ü§ñ AI Help</button>
            </div>
          </div>
        </div>

        <!-- HIGHLIGHTS -->
        <div>
          <div class="section-title">
            <span>AI-Powered Features</span>
          </div>
          <div class="dashboard-highlights mt-md">
            <div class="highlight-card">
              <div class="highlight-icon">ü§ñ</div>
              <h3>AI Code Assistance</h3>
              <p class="text-sm text-muted">Use Ollama (local) or OpenAI for AI suggestions to improve your PWA code.</p>
            </div>
            <div class="highlight-card">
              <div class="highlight-icon">‚ö°</div>
              <h3>Real-time Preview</h3>
              <p class="text-sm text-muted">See PWA updates live as you edit. Test install prompts and offline functionality.</p>
            </div>
            <div class="highlight-card">
              <div class="highlight-icon">üì¶</div>
              <h3>3-File Export</h3>
              <p class="text-sm text-muted">Export manifest.json, sw.js, and index.html ‚Äî everything you need for a PWA.</p>
            </div>
            <div class="highlight-card">
              <div class="highlight-icon">üîí</div>
              <h3>KUHUL Security</h3>
              <p class="text-sm text-muted">Built with KUHUL JavaCrypt runtime for secure, capability-governed code execution.</p>
            </div>
          </div>
        </div>

        <!-- AI CHAT -->
        <div class="chat-inference">
          <div class="section-title">
            <span>AI Chat Assistant</span>
            <div class="pill-tabs" id="model-tabs">
              <button class="pill-tab active" data-model="ollama">Ollama (Local)</button>
              <button class="pill-tab" data-model="openai">OpenAI</button>
            </div>
          </div>
          <div class="section-subtitle">Ask AI to modify your PWA files, fix issues, or add new features.</div>

          <div class="chat-stream" id="chatStream">
            <div class="chat-msg assistant">
              <strong>PWA Assistant:</strong> Hello! I can help you build and optimize your Progressive Web App. Ask me to modify any of the three PWA files. Try: "Add offline page to service worker" or "Optimize manifest for iOS".
            </div>
          </div>

          <div class="ai-thinking hidden" id="aiThinking">
            <span>AI is thinking</span>
            <div class="ai-dot"></div>
            <div class="ai-dot"></div>
            <div class="ai-dot"></div>
          </div>

          <div class="chat-input-row">
            <input type="text" class="chat-input" id="chatInput" placeholder="Ask AI to modify PWA files...">
            <button class="asx-btn asx-btn-primary" id="sendChatBtn">Send</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- =========================================================
       KUHUL JAVACRYPT SECURITY RUNTIME + PWA BUILDER
       ========================================================= -->
  <script>
  (function KUHUL_BOOT() {
    'use strict';

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       KUHUL SECURITY CORE
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    const KUHUL = {
      version: '1.2.3',
      caps: Object.freeze({
        dom_read: true,
        dom_write: true,
        net_fetch: true,
        storage: true,
        js_run: false,
        console: true
      }),

      freeze: (obj, seen = new Set()) => {
        if (!obj || typeof obj !== 'object' || seen.has(obj)) return obj;
        seen.add(obj);
        Object.freeze(obj);
        for (const k of Object.keys(obj)) KUHUL.freeze(obj[k], seen);
        return obj;
      },

      uid: () => Date.now().toString(36) + Math.random().toString(36).slice(2),

      clamp: (s, max = 4096) => {
        s = String(s ?? '');
        return s.length > max ? s.slice(0, max) : s;
      },

      escapeHtml: (text) => {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      },

      log: {
        info: (...args) => console.info('[KUHUL]', ...args),
        warn: (...args) => console.warn('[KUHUL]', ...args),
        error: (...args) => console.error('[KUHUL]', ...args)
      },

      dom: {
        q: (sel) => document.querySelector(sel),
        qa: (sel) => Array.from(document.querySelectorAll(sel)),
        byId: (id) => document.getElementById(id),
        setText: (el, text) => { if (el) el.textContent = String(text ?? ''); },
        setHTML: (el, html) => { if (el) el.innerHTML = String(html ?? ''); }
      },

      on: (el, event, handler) => {
        if (typeof el === 'string') el = document.querySelector(el);
        el?.addEventListener(event, handler);
      },

      app: null, // Will be set by PWABuilder
      sw: null   // Will be set by SW bridge
    };

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       SERVICE WORKER BRIDGE
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    const SW = {
      ready: false,
      controller: null,

      async init() {
        if (!('serviceWorker' in navigator)) {
          KUHUL.log.warn('Service Worker not supported');
          return;
        }

        try {
          const reg = await navigator.serviceWorker.register('/sw.js', { scope: '/' });
          KUHUL.log.info('SW registered:', reg.scope);

          navigator.serviceWorker.addEventListener('message', SW.onMessage);

          if (navigator.serviceWorker.controller) {
            SW.controller = navigator.serviceWorker.controller;
            SW.ready = true;
            SW.send({ t: 'BOOT' });
          } else {
            navigator.serviceWorker.addEventListener('controllerchange', () => {
              SW.controller = navigator.serviceWorker.controller;
              SW.ready = true;
              SW.send({ t: 'BOOT' });
            });
          }
        } catch (err) {
          KUHUL.log.error('SW registration failed:', err);
        }
      },

      send(msg) {
        if (SW.controller) SW.controller.postMessage(msg);
      },

      onMessage(event) {
        const msg = event.data;
        if (!msg?.t) return;
        KUHUL.log.info('SW message:', msg.t);
      }
    };

    KUHUL.sw = SW;

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       PWA BUILDER APPLICATION
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    class PWABuilder {
      constructor() {
        this.currentProject = 'default';
        this.projects = new Map();
        this.currentFile = 'manifest';
        this.aiEndpoint = 'http://localhost:11434/api/generate';
        this.aiModel = 'llama2';
        this.openaiKey = '';
        this.activeModel = 'ollama';
        this.pendingAiResponse = null;
        this.chatHistory = [];
      }

      async init() {
        this.loadProjects();
        this.setupEventListeners();
        this.updateProjectList();
        this.switchFile('manifest');
        SW.init();
        KUHUL.log.info('PWA Builder initialized');
      }

      loadProjects() {
        const saved = localStorage.getItem('pwa-projects-v2');
        if (saved) {
          try {
            const data = JSON.parse(saved);
            this.projects = new Map(data.projects || []);
            this.currentProject = data.currentProject || 'default';
            if (!this.projects.has(this.currentProject)) this.createDefaultProject();
          } catch (e) {
            this.createDefaultProject();
          }
        } else {
          this.createDefaultProject();
        }
        this.loadProject(this.currentProject);
      }

      createDefaultProject() {
        const project = {
          id: 'default',
          name: 'Default PWA',
          description: 'A Progressive Web App built with MX2LM OS',
          created: Date.now(),
          updated: Date.now(),
          files: {
            manifest: JSON.stringify({
              name: "My PWA App",
              short_name: "PWA App",
              description: "Built with MX2LM OS PWA Builder",
              start_url: "/",
              display: "standalone",
              background_color: "#020409",
              theme_color: "#16f2aa",
              orientation: "any",
              icons: [
                { src: "icon-192.png", sizes: "192x192", type: "image/png", purpose: "any maskable" },
                { src: "icon-512.png", sizes: "512x512", type: "image/png", purpose: "any maskable" }
              ]
            }, null, 2),
            sw: `// Service Worker v1.0.0
const CACHE_NAME = 'pwa-cache-v1';
const OFFLINE_URL = '/offline.html';
const URLS_TO_CACHE = ['/', '/index.html', '/manifest.json', '/offline.html'];

self.addEventListener('install', event => {
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then(cache => cache.addAll(URLS_TO_CACHE))
      .then(() => self.skipWaiting())
  );
});

self.addEventListener('activate', event => {
  event.waitUntil(
    caches.keys().then(keys =>
      Promise.all(keys.filter(k => k !== CACHE_NAME).map(k => caches.delete(k)))
    ).then(() => self.clients.claim())
  );
});

self.addEventListener('fetch', event => {
  if (event.request.mode === 'navigate') {
    event.respondWith(
      fetch(event.request).catch(() => caches.match(OFFLINE_URL))
    );
    return;
  }
  event.respondWith(
    caches.match(event.request).then(r => r || fetch(event.request))
  );
});`,
            index: `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My PWA</title>
  <meta name="theme-color" content="#16f2aa">
  <meta name="description" content="A Progressive Web App">
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: system-ui, sans-serif; background: #020409; color: #e6fffa; min-height: 100vh; display: flex; flex-direction: column; }
    header { padding: 1rem; background: rgba(5,9,18,0.9); border-bottom: 1px solid rgba(148,163,184,0.3); }
    main { flex: 1; display: flex; align-items: center; justify-content: center; text-align: center; padding: 2rem; }
    h1 { background: linear-gradient(135deg, #16f2aa, #22d3ee); -webkit-background-clip: text; background-clip: text; color: transparent; }
    .install-btn { margin-top: 2rem; padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #16f2aa, #22d3ee); color: #020409; border: none; border-radius: 999px; font-weight: bold; cursor: pointer; }
  </style>
</head>
<body>
  <header>My PWA</header>
  <main>
    <div>
      <h1>Welcome to My PWA</h1>
      <p>A Progressive Web App with offline support.</p>
      <button class="install-btn" id="installBtn">Install App</button>
    </div>
  </main>
  <script>
    if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', e => { e.preventDefault(); deferredPrompt = e; });
    document.getElementById('installBtn').onclick = () => { if (deferredPrompt) { deferredPrompt.prompt(); deferredPrompt = null; } };
  </script>
</body>
</html>`
          },
          settings: { name: 'My PWA App', shortName: 'PWA App', themeColor: '#16f2aa', bgColor: '#020409' }
        };
        this.projects.set('default', project);
        this.saveProjects();
      }

      saveProjects() {
        const data = { currentProject: this.currentProject, projects: Array.from(this.projects.entries()) };
        localStorage.setItem('pwa-projects-v2', JSON.stringify(data));
        this.updateProjectList();
      }

      loadProject(id) {
        const project = this.projects.get(id);
        if (!project) return;
        this.currentProject = id;
        KUHUL.dom.setText(KUHUL.dom.byId('currentProjectDisplay'), project.name);
        KUHUL.dom.byId('pwaName').value = project.settings.name;
        KUHUL.dom.byId('pwaShortName').value = project.settings.shortName;
        KUHUL.dom.byId('pwaThemeColor').value = project.settings.themeColor;
        KUHUL.dom.byId('pwaBgColor').value = project.settings.bgColor;
        this.switchFile('manifest');
        this.addChatMessage('assistant', `Loaded project: ${project.name}`);
        this.updateStats();
      }

      updateProjectList() {
        const grid = KUHUL.dom.byId('projectsGrid');
        grid.innerHTML = '';
        this.projects.forEach((project, id) => {
          const card = document.createElement('div');
          card.className = `project-card ${id === this.currentProject ? 'active' : ''}`;
          card.innerHTML = `<div style="font-weight:600;font-size:var(--size-sm)">${KUHUL.escapeHtml(project.name)}</div><div style="font-size:var(--size-xs);color:var(--text-muted)">${new Date(project.updated).toLocaleDateString()}</div>`;
          card.onclick = () => this.loadProject(id);
          grid.appendChild(card);
        });
        KUHUL.dom.setText(KUHUL.dom.byId('projectsCount'), `${this.projects.size} projects`);
        KUHUL.dom.setText(KUHUL.dom.byId('totalProjects'), this.projects.size);
      }

      setupEventListeners() {
        // Sidebar tabs
        KUHUL.dom.qa('.pwa-sidebar-tab').forEach(tab => {
          KUHUL.on(tab, 'click', () => {
            KUHUL.dom.qa('.pwa-sidebar-tab').forEach(t => t.classList.remove('active'));
            KUHUL.dom.qa('.pwa-editor-container').forEach(c => c.classList.remove('active'));
            tab.classList.add('active');
            KUHUL.dom.byId(`pwa-${tab.dataset.target}`).classList.add('active');
          });
        });

        // File tabs
        KUHUL.dom.qa('#file-tabs .pill-tab').forEach(tab => {
          KUHUL.on(tab, 'click', () => this.switchFile(tab.dataset.file));
        });

        // Model tabs
        KUHUL.dom.qa('#model-tabs .pill-tab').forEach(tab => {
          KUHUL.on(tab, 'click', () => {
            KUHUL.dom.qa('#model-tabs .pill-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            this.activeModel = tab.dataset.model;
          });
        });

        // Buttons
        KUHUL.on('#exportPwaBtn', 'click', () => this.showExportModal());
        KUHUL.on('#aiSettingsBtn', 'click', () => this.showModal('settingsModal'));
        KUHUL.on('#sendChatBtn', 'click', () => this.sendChatMessage());
        KUHUL.on('#chatInput', 'keydown', (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); this.sendChatMessage(); } });
        KUHUL.on('#urlOpenBtn', 'click', () => this.testApiUrl());
        KUHUL.on('#urlInput', 'keydown', (e) => { if (e.key === 'Enter') this.testApiUrl(); });

        // Editor content change
        KUHUL.on('#editorContent', 'input', () => this.updateFileInfo());

        // Escape key
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            ['exportModal', 'newProjectModal', 'aiResponseModal', 'settingsModal'].forEach(id => this.hideModal(id));
          }
        });
      }

      switchFile(file) {
        this.currentFile = file;
        KUHUL.dom.qa('#file-tabs .pill-tab').forEach(tab => tab.classList.toggle('active', tab.dataset.file === file));
        const project = this.projects.get(this.currentProject);
        if (project?.files[file]) KUHUL.dom.byId('editorContent').value = project.files[file];
        this.updateFileInfo();
      }

      updateFileInfo() {
        const content = KUHUL.dom.byId('editorContent').value;
        const names = { manifest: 'manifest.json', sw: 'sw.js', index: 'index.html' };
        KUHUL.dom.setText(KUHUL.dom.byId('fileInfo'), `${names[this.currentFile]} ‚Ä¢ ${content.length} characters`);
      }

      saveCurrentFile() {
        const project = this.projects.get(this.currentProject);
        if (!project) return;
        project.files[this.currentFile] = KUHUL.dom.byId('editorContent').value;
        project.updated = Date.now();
        this.projects.set(this.currentProject, project);
        this.saveProjects();
        this.addChatMessage('assistant', `Saved ${this.currentFile} file.`);
      }

      formatCurrentFile() {
        const editor = KUHUL.dom.byId('editorContent');
        try {
          if (this.currentFile === 'manifest') {
            editor.value = JSON.stringify(JSON.parse(editor.value), null, 2);
            this.addChatMessage('assistant', 'Formatted JSON.');
          }
        } catch (e) {
          this.addChatMessage('assistant', `Format error: ${e.message}`);
        }
      }

      saveAllFiles() {
        const project = this.projects.get(this.currentProject);
        if (!project) return;
        project.files[this.currentFile] = KUHUL.dom.byId('editorContent').value;
        project.settings = {
          name: KUHUL.dom.byId('pwaName').value,
          shortName: KUHUL.dom.byId('pwaShortName').value,
          themeColor: KUHUL.dom.byId('pwaThemeColor').value,
          bgColor: KUHUL.dom.byId('pwaBgColor').value
        };
        project.updated = Date.now();
        this.projects.set(this.currentProject, project);
        this.saveProjects();
        this.addChatMessage('assistant', 'All files saved.');
      }

      savePwaSettings() {
        this.saveAllFiles();
        this.updatePreview();
        this.addChatMessage('assistant', 'PWA settings saved.');
      }

      updatePreview() {
        const project = this.projects.get(this.currentProject);
        const frame = KUHUL.dom.byId('previewFrame');
        if (project && frame) {
          frame.srcdoc = project.files.index || '';
        }
      }

      updateStats() {
        KUHUL.dom.setText(KUHUL.dom.byId('totalProjects'), this.projects.size);
      }

      // AI Methods
      async sendChatMessage() {
        const input = KUHUL.dom.byId('chatInput');
        const message = input.value.trim();
        if (!message) return;

        this.addChatMessage('user', message);
        input.value = '';
        KUHUL.dom.byId('aiThinking').classList.remove('hidden');

        try {
          const response = await this.callAI(message);
          KUHUL.dom.byId('aiThinking').classList.add('hidden');
          this.addChatMessage('assistant', response);

          if (response.includes('```') || (response.includes('{') && response.includes('}'))) {
            this.showAiResponse(response);
          }
        } catch (err) {
          KUHUL.dom.byId('aiThinking').classList.add('hidden');
          this.addChatMessage('assistant', `AI Error: ${err.message}. Try checking your AI settings.`);
        }
      }

      async callAI(prompt) {
        const context = `Current PWA file: ${this.currentFile}\nContent preview:\n${KUHUL.dom.byId('editorContent').value.substring(0, 500)}...\n\nUser: ${prompt}`;

        if (this.activeModel === 'ollama') {
          try {
            const res = await fetch(this.aiEndpoint, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ model: this.aiModel, prompt: context, stream: false })
            });
            const data = await res.json();
            return data.response || 'No response from Ollama.';
          } catch (e) {
            throw new Error(`Ollama not available. Start Ollama with: ollama serve`);
          }
        } else if (this.activeModel === 'openai' && this.openaiKey) {
          const res = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${this.openaiKey}` },
            body: JSON.stringify({ model: 'gpt-3.5-turbo', messages: [{ role: 'user', content: context }] })
          });
          const data = await res.json();
          return data.choices?.[0]?.message?.content || 'No response from OpenAI.';
        }

        // Fallback demo response
        return this.getDemoResponse();
      }

      getDemoResponse() {
        const responses = {
          manifest: `Here's an improved manifest.json:\n\n\`\`\`json\n${JSON.stringify({
            name: "Enhanced PWA", short_name: "PWA", description: "A Progressive Web App",
            start_url: "/", display: "standalone", background_color: "#020409", theme_color: "#16f2aa",
            icons: [{ src: "icon-192.png", sizes: "192x192", type: "image/png", purpose: "any maskable" }]
          }, null, 2)}\n\`\`\``,
          sw: `Here's an improved service worker:\n\n\`\`\`javascript\nconst CACHE = 'v2';\nself.addEventListener('install', e => e.waitUntil(caches.open(CACHE).then(c => c.addAll(['/'])).then(() => self.skipWaiting())));\n\`\`\``,
          index: `Add this meta tag for better PWA support:\n\n\`\`\`html\n<meta name="apple-mobile-web-app-capable" content="yes">\n\`\`\``
        };
        return responses[this.currentFile] || 'I can help you improve your PWA files. Try asking about manifest, service worker, or index.html.';
      }

      askAiForHelp() {
        const prompt = `Help me improve this ${this.currentFile} file for better PWA practices.`;
        KUHUL.dom.byId('chatInput').value = prompt;
        this.sendChatMessage();
      }

      optimizeWithAI() {
        const prompt = `Optimize this ${this.currentFile} file for better PWA performance and best practices.`;
        KUHUL.dom.byId('chatInput').value = prompt;
        this.sendChatMessage();
      }

      showAiResponse(response) {
        KUHUL.dom.setHTML(KUHUL.dom.byId('aiResponseContent'), `
          <div class="text-sm text-muted">AI suggestions for ${this.currentFile}:</div>
          <div style="margin-top:var(--sp-sm);padding:var(--sp-sm);background:rgba(15,23,42,0.7);border-radius:var(--rad-md);font-family:var(--font-mono);font-size:var(--size-xs);overflow-x:auto;white-space:pre-wrap">${KUHUL.escapeHtml(response)}</div>
        `);
        this.pendingAiResponse = response;
        this.showModal('aiResponseModal');
      }

      applyAiChanges() {
        if (!this.pendingAiResponse) return;
        const codeMatch = this.pendingAiResponse.match(/```(?:json|javascript|html)?\n([\s\S]*?)\n```/);
        if (codeMatch) {
          KUHUL.dom.byId('editorContent').value = codeMatch[1];
          this.saveCurrentFile();
        }
        this.hideModal('aiResponseModal');
        this.pendingAiResponse = null;
      }

      saveAiSettings() {
        this.aiEndpoint = KUHUL.dom.byId('ollamaEndpoint').value;
        this.aiModel = KUHUL.dom.byId('ollamaModel').value;
        this.openaiKey = KUHUL.dom.byId('openaiKey').value;
        localStorage.setItem('pwa-ai-settings', JSON.stringify({ endpoint: this.aiEndpoint, model: this.aiModel, openaiKey: this.openaiKey }));
        this.hideModal('settingsModal');
        this.addChatMessage('assistant', 'AI settings saved.');
      }

      addChatMessage(role, text) {
        const stream = KUHUL.dom.byId('chatStream');
        const msg = document.createElement('div');
        msg.className = `chat-msg ${role}`;
        msg.innerHTML = `<strong>${role === 'user' ? 'You' : 'PWA Assistant'}:</strong> ${KUHUL.escapeHtml(text)}`;
        stream.appendChild(msg);
        stream.scrollTop = stream.scrollHeight;
      }

      // Project Management
      createNewProject() {
        const name = KUHUL.dom.byId('projectName').value.trim();
        if (!name) { this.addChatMessage('assistant', 'Please enter a project name.'); return; }

        const id = name.toLowerCase().replace(/\s+/g, '-') + '-' + KUHUL.uid().slice(0, 4);
        const defaultProj = this.projects.get('default');
        const project = {
          id, name,
          description: KUHUL.dom.byId('projectDescription').value,
          created: Date.now(), updated: Date.now(),
          files: { ...defaultProj.files },
          settings: { name, shortName: name.slice(0, 12), themeColor: '#16f2aa', bgColor: '#020409' }
        };

        this.projects.set(id, project);
        this.saveProjects();
        this.loadProject(id);
        this.hideModal('newProjectModal');
        this.addChatMessage('assistant', `Created project: ${name}`);
      }

      importProject() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.onchange = async (e) => {
          const file = e.target.files[0];
          const content = await file.text();
          try {
            const project = JSON.parse(content);
            if (!project.id || !project.files) throw new Error('Invalid format');
            this.projects.set(project.id, project);
            this.saveProjects();
            this.loadProject(project.id);
            this.addChatMessage('assistant', `Imported: ${project.name}`);
          } catch (err) {
            this.addChatMessage('assistant', `Import failed: ${err.message}`);
          }
        };
        input.click();
      }

      // Export
      showExportModal() {
        const project = this.projects.get(this.currentProject);
        if (!project) return;
        const files = [
          { name: 'manifest.json', content: project.files.manifest },
          { name: 'sw.js', content: project.files.sw },
          { name: 'index.html', content: project.files.index }
        ];
        KUHUL.dom.setHTML(KUHUL.dom.byId('exportFilesList'), files.map(f => `
          <div class="flex-between" style="padding:var(--sp-sm);border:1px solid var(--border-ui);border-radius:var(--rad-md);margin-bottom:var(--sp-xs)">
            <div><div style="font-weight:600">${f.name}</div><div class="text-xs text-muted">${f.content.length} chars</div></div>
            <button class="asx-btn" onclick="KUHUL.app.downloadFile('${f.name}')">Download</button>
          </div>
        `).join(''));
        this.showModal('exportModal');
      }

      downloadFile(filename) {
        const project = this.projects.get(this.currentProject);
        const fileMap = { 'manifest.json': 'manifest', 'sw.js': 'sw', 'index.html': 'index' };
        const content = project.files[fileMap[filename]];
        const blob = new Blob([content], { type: 'application/octet-stream' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = filename;
        a.click();
        URL.revokeObjectURL(a.href);
      }

      downloadAllFiles() {
        ['manifest.json', 'sw.js', 'index.html'].forEach((f, i) => setTimeout(() => this.downloadFile(f), i * 200));
        this.hideModal('exportModal');
        this.addChatMessage('assistant', 'Downloading all PWA files...');
      }

      // API Test
      async testApiUrl() {
        const url = KUHUL.dom.byId('urlInput').value.trim();
        if (!url) return;
        this.addChatMessage('user', `Testing API: ${url}`);
        try {
          const res = await fetch(url);
          const data = await res.text();
          this.addChatMessage('assistant', `API Response (${res.status}):\n${data.substring(0, 500)}...`);
        } catch (e) {
          this.addChatMessage('assistant', `API Error: ${e.message}`);
        }
      }

      // Modal helpers
      showModal(id) { KUHUL.dom.byId(id).classList.add('active'); }
      hideModal(id) { KUHUL.dom.byId(id).classList.remove('active'); }
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       GLYPH RAIN ANIMATION
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    (function initGlyphRain() {
      const canvas = document.getElementById('glyph-rain');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      const glyphs = '‚üÅŒ©ŒªœÄŒ£ŒûŒ¶Œ®‚ú∂‚ú∫‚ú¶‚úßÔºä01';
      let width, height, columns, drops;

      function resize() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
        columns = Math.floor(width / 16);
        drops = Array.from({ length: columns }, () => Math.random() * height);
      }

      function draw() {
        ctx.fillStyle = 'rgba(2, 6, 23, 0.16)';
        ctx.fillRect(0, 0, width, height);
        ctx.fillStyle = 'rgba(34, 211, 238, 0.75)';
        ctx.font = '14px "JetBrains Mono", monospace';

        for (let i = 0; i < drops.length; i++) {
          const text = glyphs[Math.floor(Math.random() * glyphs.length)];
          ctx.fillText(text, i * 16, drops[i] * 16);
          if (drops[i] * 16 > height && Math.random() > 0.975) drops[i] = 0;
          else drops[i] += 0.5 + Math.random() * 0.5;
        }
        requestAnimationFrame(draw);
      }

      window.addEventListener('resize', resize);
      resize();
      requestAnimationFrame(draw);
    })();

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       BOOT
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    const app = new PWABuilder();
    KUHUL.app = app;
    window.KUHUL = KUHUL;
    document.addEventListener('DOMContentLoaded', () => app.init());

  })();
  </script>
</body>
</html>
